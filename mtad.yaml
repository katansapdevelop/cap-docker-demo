ID: logicalstar.docker.demo.app
_schema-version: 3.3.0
version: 0.0.0

modules:
  # A cf app consuming the configuration
  - name: cap-docker-demo-app
    type: application # value custom would do just as well
    parameters: # All parameters are optional and can be deleted - defaults will be taken/detected if non specified.
      docker:   # Schedule a docker image found in that repository instead of staging bits
        image: katan/cap-docker-demo # repo/image:tag
        # username: <optional username> # credentials to access docker repo
        # password: <optional password>
      instances: 1  #optional
      disk-quota: 2GB 
      routes: # Optional, otherwise one generated by template is assigned
      - route: ${app-name}.${domain}
    properties:  # How environment variables are defined
      MY_ENV_VAR: "value-of-my-env-var"
    requires:
    - name: cap-docker-demo-destinations
    - name: cap-docker-demo-auth
    provides:
    - name: srv-api
      properties:
        srv-url: ${default-url}

  - name: cap-docker-demo-app-destinations
    type: com.sap.application.content
    requires:
      - name: cap-docker-demo-auth
        parameters:
          service-key:
            name: cap-docker-demo-auth-key      
      - name: srv-api
      - name: cap-docker-demo-destinations
        parameters:
          content-target: true
    parameters:
      content:
        instance:
          destinations:
            - Authentication: OAuth2UserTokenExchange
              Name: cap-docker-demo-app-srv
              TokenServiceInstanceName: cap-docker-demo-auth
              TokenServiceKeyName: cap-docker-demo-auth-key
              URL: '~{srv-api/srv-url}'
              #sap.cloud.service: cap.docker.demo
            - Authentication: OAuth2UserTokenExchange
              Name: cap-docker-demo-auth
              ServiceInstanceName: cap-docker-demo-auth
              ServiceKeyName: cap-docker-demo-auth-key
              #sap.cloud.service: cap.docker.demo
          existing_destinations_policy: update  
    build-parameters:
      no-source: true


resources:
- name: cap-docker-demo-destinations
  type: org.cloudfoundry.managed-service
  parameters:
    service: destination
    service-plan: lite
    config:
      init_data:
        instance:
          destinations:
          - Authentication: OAuth2ClientCredentials
            Name: IS_APIS
            ProxyType: Internet
            Description: Destination to access IS APIs
            Type: HTTP
            URL: https://5ebed044trial.it-cpitrial06.cfapps.us10-001.hana.ondemand.com/api/v1
        existing_destinations_policy: ignore

- name: cap-docker-demo-auth
  type: org.cloudfoundry.managed-service
  parameters:
    config:
      tenant-mode: dedicated
      xsappname: cap-docker-demo-auth
    path: ./xs-security.json
    service: xsuaa
    service-plan: application
